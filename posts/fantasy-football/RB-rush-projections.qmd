---
title: "Running Back in Style"
format: html
---

Running Backs had their moment this past season. A recently maligned position group thought to provide little value to team production made a momentary sigh of relief. Leading the comeback story was Saquon Barkley's near record breaking campaign and Super Bowl run after being dicarded by his former team and now division rival New York Giants. His monumental impact to the Eagles Super Bowl season did not go unnoticed as he was rewarded with a big [contract extention](https://www.espn.com/nfl/story/_/id/44124382/nfl-free-agency-2025-saquon-barkley-change-running-back-contracts-eagles) in March. He wasn't the only one rewarded with a new deal as Derrick Henry received a 2 year extentions following his recent debut season with the Ravens. Those players however aren't anomalies, as some exciting and dynamic stars such as Detroit's Jamyhr Gibbs and Atlanta's Bijan Robinson have both added to the strong case of the position group's value revival. It seems to have also convinced teams this season to invest more in the short dip in the RB market. 

In this year's draft, 5 RBs were selected in the top 60 picks, 1 of which (Ashton Jeanty) was selected number 6. All of this leads me to believe that RB value is on the upswing. 


For the past few years, the analytics has discussed at length, the value of each position driven by a desire to optimize where teams spend their resources (draft picks, money, etc.). The prevailing argument coming out of this research was that teams can be successful without investing heavily in position due to a variety of factors including teams adopting pass-heavy approaches, importance of offensive line play and impact, backfield by committee, and the contract values of running backs.

I'm hoping to address the last 2 points in this post. The decline of a "workhorse" back and the increase in rush duties shared among multiple runnings and, at times, the QB. Teams have tended to rely slightly less on one RB for a number of reasons. One of the prime reasons was the hesitancy to put the that kind of load on the bodies of one player. Football is a violent game and taking hits has a toll. A recent run of talented RBs declining after signing massive contracts is a reason teams have been scared off of committing large amounts of resources recently. Players like Todd Gurley, Ezekiel Elliot, and Le'Veon Bell have all experienced precipotous decline and/or serious injuries after signing large long-term contracts.

While it's certainly proven riskier to spend resources on runnings there still have been plenty of RBs who have continued to produce. Henry himself had a stellar season at age 30. Alvin Kamara, Christian, McCafferey, Josh Jacobs, and Barkley have all produced well after receiving long-term contracts. How can we predict whether the contract is worth it? Is there a way to tell how much proverbial gas is left in the tank for these guys. Let's find out...


```{r}
# Create Time Weighting 

weighted_sum = function(x,alpha=0.8){
  
  # Take in sliding window of vector of chosen metric

  n <- length(x)
  w_sum = sapply(1:n, function(i) {
    weights <- alpha^((i - 1):0)  # Most recent gets highest weight (alpha^0 = 1)
    values <- x[1:i]
    weighted_sum <- sum(values * weights, na.rm = FALSE) / sum(weights)
    return(weighted_sum)
  })
  
  return(w_sum)
  
}
```


```{r}
library(nflreadr)

player_stats = load_player_stats(seasons = seq(2006,2023),stat_type = "offense")
player_rosters = load_rosters(seasons = seq(2006,2023))

stat_cols = c('carries','rushing_yards','targets','receptions','receiving_yards',"fantasy_points","games")
player_stats |> 
  filter(position == 'RB') |>
  arrange(desc(season),desc(week)) |>
  group_by(player_id,season,) |> 
  summarise(games = n(),
            # Team they start season with
            recent_team = first(recent_team),
            player_name = last(player_name),
            across(stat_cols,.fns = sum)) |> 
  select(c(player_id,player_name,recent_team,season,stat_cols)) -> rush_stats


# Calculate cumulative sums of stats endured so far
rush_stats |> 
  group_by(player_id) |> 
  left_join(rb_injuries,by = c('season','player_id' = 'gsis_id')) |> 
  replace_na(list(weeks_missed = 0)) |> 
  # Compute 1 year lag of all numeric columns
  mutate(across(where(is.numeric), ~lag(.), .names = "{.col}_lag1"),
         weeks_inj = lag(cumsum(weeks_missed)),
         across(stat_cols, ~lag(cumsum(.)), .names = "{.col}_career_sum"),
         across(stat_cols, ~lag(weighted_sum(.)), .names = "{.col}_wt_sum")) -> agg_stats
  
```


```{r}
# Injuries

nflreadr::load_injuries(seasons = seq(2009,2023)) -> injuries

injuries |> 
  filter(position=="RB") |> 
  group_by(gsis_id,season) |> 
  summarise(weeks_missed = sum(report_status == "Out",na.rm = T)) |> 
  ungroup() -> rb_injuries


```


```{r}
player_rosters |> 
  filter(position == 'RB') |> 
  arrange(season,week) |> 
  group_by(season,gsis_id,position,birth_date,entry_year,college,draft_club,draft_number) |> 
  summarise(full_name = last(full_name),
            week = last(week),
            team = last(team),
            years_exp = last(years_exp),
            height = last(height),
            weight = last(weight)) |> 
  ungroup() |> 
  mutate(
    approx_age = lubridate::time_length(as.Date(paste(season,'03','01',sep = '-'))-birth_date,unit = 'years'),
    # Denotes UDFA
    draft_number = as.numeric(ifelse(
      is.na(draft_number),263,draft_number
      
    ))) |> 
  arrange(desc(season)) |> 
  select(gsis_id,season,years_exp,height,weight,approx_age,draft_number)-> rb_roster_info


# Contract Info
nflreadr::load_contracts()-> contracts

contracts |> 
  # Last 
  filter(position=='RB') |> 
  select(year_signed,value, years,gsis_id,apy_cap_pct) |> 
  distinct() -> rb_contracts

roster_contract = rb_roster_info |> 
  left_join(rb_contracts,by = c("season" = "year_signed","gsis_id")) |> 
  arrange(desc(season)) |> 
  group_by(gsis_id) |> 
  # Fill contract columns "up" to fill in blanks
  fill(c(value,years,apy_cap_pct),.direction = 'up')


```



```{r}
rb_roster_info |> 
  filter(gsis_id == '00-0034844')

roster_contract |> 
  filter(gsis_id == '00-0034844')

```






```{r}
# Advanced Stats
load_pfr_advstats(
  seasons = seq(2018,2023),
  stat_type = "rush",
  summary_level = "season",
  file_type = getOption("nflreadr.prefer", default = "rds")
)
```




Links:
https://opensourcefootball.com/posts/2020-08-25-open-source-fantasy-football-visualizing-trap-backs/

https://www.unexpectedpoints.com/p/what-analytical-draft-value-curves

https://opensourcefootball.com/posts/2023-02-23-nfl-draft-value-chart/